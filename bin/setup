#!/usr/bin/env sh

# Set up Rails app. Run this script immediately after cloning the codebase.
# https://github.com/thoughtbot/guides/tree/master/protocol

save_bundle_md () {
  bundle install
  echo $MD5 > $GEMFILE_MD5
  echo "Saving Bundle MD5..."
}

set -e

GEMFILE_MD5=.bundle/GEMFILE_MD5

MD5=$(md5 Gemfile)

if ! [ -f $GEMFILE_MD5 ]; then
  save_bundle_md
elif [[ "$(cat $GEMFILE_MD5)" != "$MD5" ]]; then
  save_bundle_md
fi

echo "Running migrations..."

bin/rake db:create db:migrate db:test:clone